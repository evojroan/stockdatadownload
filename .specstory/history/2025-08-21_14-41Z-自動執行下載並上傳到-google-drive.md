<!-- Generated by SpecStory -->

# è‡ªå‹•åŸ·è¡Œä¸‹è¼‰ä¸¦ä¸Šå‚³åˆ° Google Drive (2025-08-21 14:41Z)

_**User**_

æˆ‘è¦éƒ¨ç½²åˆ°ç¶²è·¯ä¸Šï¼Œæ ¹æ“š cron æ™‚é–“è‡ªå‹•åŸ·è¡Œï¼Œä¸”ä¸‹è¼‰çš„æª”æ¡ˆ (CSV)ä¸Šå‚³åˆ° Google driveã€‚æˆ‘æœ‰å“ªäº›æ–¹æ³•ï¼Ÿ

---

_**Assistant**_

æ ¹æ“šæ‚¨çš„éœ€æ±‚ï¼Œè¦éƒ¨ç½²åˆ°ç¶²è·¯ä¸Šä¸¦æ ¹æ“š cron æ™‚é–“è‡ªå‹•åŸ·è¡Œï¼ŒåŒæ™‚å°‡ CSV æª”æ¡ˆä¸Šå‚³åˆ° Google Driveï¼Œæ‚¨æœ‰ä»¥ä¸‹å¹¾ç¨®æ–¹æ³•ï¼š

## ä¸»è¦éƒ¨ç½²é¸é …ï¼š

### 1. **é›²ç«¯å¹³å°éƒ¨ç½² (æ¨è–¦)**
- **Heroku**: æ”¯æ´ cron jobsï¼Œæœ‰å…è²»æ–¹æ¡ˆ
- **Railway**: ç°¡å–®éƒ¨ç½²ï¼Œæ”¯æ´ cron
- **Render**: å…è²»æ–¹æ¡ˆï¼Œæ”¯æ´ cron
- **Vercel**: é©åˆ Node.js æ‡‰ç”¨ï¼Œæ”¯æ´ cron

### 2. **é›²ç«¯æœå‹™å™¨**
- **AWS EC2**: å®Œå…¨æ§åˆ¶ï¼Œå¯è¨­å®š cron
- **Google Cloud Platform**: æ•´åˆ Google Drive API æ–¹ä¾¿
- **DigitalOcean**: ç°¡å–®æ˜“ç”¨ï¼Œæ”¯æ´ cron

### 3. **å®¹å™¨åŒ–éƒ¨ç½²**
- **Docker + é›²ç«¯å¹³å°**: å¯ç§»æ¤æ€§é«˜
- **Kubernetes**: ä¼æ¥­ç´šè§£æ±ºæ–¹æ¡ˆ

## æŠ€è¡“å¯¦ç¾è¦é»ï¼š

### Cron è‡ªå‹•åŒ–ï¼š
- ä½¿ç”¨ `node-cron` å¥—ä»¶
- é›²ç«¯å¹³å°çš„å…§å»º cron åŠŸèƒ½
- ç³»çµ±ç´š cron ä»»å‹™

### Google Drive æ•´åˆï¼š
- ä½¿ç”¨ Google Drive API
- éœ€è¦ OAuth 2.0 èªè­‰
- å®šæœŸæ›´æ–° access token

### æª”æ¡ˆè™•ç†ï¼š
- ä¸‹è¼‰ CSV å¾Œç«‹å³ä¸Šå‚³
- è¨­å®šæª”æ¡ˆå‘½åè¦å‰‡
- è™•ç†é‡è¤‡æª”æ¡ˆå•é¡Œ

æ‚¨å¸Œæœ›æˆ‘å¹«æ‚¨å¯¦ä½œå“ªä¸€ç¨®æ–¹æ¡ˆï¼Ÿæˆ–è€…æ‚¨éœ€è¦æ›´è©³ç´°çš„æŠ€è¡“èªªæ˜ï¼Ÿ

---

_**User**_

æ‰€ä»¥æˆ‘æŠŠæœ¬å°ˆæ¡ˆæª”ä½ˆç½²åˆ° Vercel ä¸Šå°±å¥½äº†ï¼Ÿ

---

_**Assistant**_

è®“æˆ‘å…ˆæª¢æŸ¥æ‚¨çš„å°ˆæ¡ˆçµæ§‹å’Œç¨‹å¼ç¢¼ï¼Œä»¥ç¢ºå®šæ˜¯å¦é©åˆéƒ¨ç½²åˆ° Vercelã€‚


---

Read file: app.js

---

Read file: package.json

---

**ä¸å»ºè­°ç›´æ¥éƒ¨ç½²åˆ° Vercelï¼** æ‚¨çš„å°ˆæ¡ˆæœ‰ä»¥ä¸‹å•é¡Œï¼š

## ä¸»è¦å•é¡Œï¼š

### 1. **Playwright ç€è¦½å™¨ä¾è³´**
- Vercel æ˜¯ç„¡ä¼ºæœå™¨ç’°å¢ƒï¼Œç„¡æ³•åŸ·è¡Œå®Œæ•´çš„ Chromium ç€è¦½å™¨
- Playwright éœ€è¦ç³»çµ±ç´šç€è¦½å™¨æ”¯æ´

### 2. **æª”æ¡ˆç³»çµ±æ“ä½œ**
- Vercel çš„æª”æ¡ˆç³»çµ±æ˜¯å”¯è®€çš„ï¼Œç„¡æ³•å»ºç«‹è³‡æ–™å¤¾å’Œå„²å­˜æª”æ¡ˆ
- æ‚¨çš„ç¨‹å¼ç¢¼ä¸­æœ‰ `fs.mkdir()` å’Œæª”æ¡ˆä¸‹è¼‰åŠŸèƒ½

### 3. **é•·æ™‚é–“åŸ·è¡Œ**
- Vercel æœ‰å‡½æ•¸åŸ·è¡Œæ™‚é–“é™åˆ¶ï¼ˆé€šå¸¸ 10-30 ç§’ï¼‰
- æ‚¨çš„çˆ¬èŸ²ç¨‹å¼éœ€è¦è¼ƒé•·æ™‚é–“åŸ·è¡Œ

## å»ºè­°çš„æ›¿ä»£æ–¹æ¡ˆï¼š

### **Railway** (æ¨è–¦)
- æ”¯æ´å®Œæ•´çš„ Node.js ç’°å¢ƒ
- å¯ä»¥åŸ·è¡Œ Playwright å’Œç€è¦½å™¨
- æœ‰å…§å»º cron åŠŸèƒ½
- æ”¯æ´æª”æ¡ˆç³»çµ±æ“ä½œ

### **Render**
- é¡ä¼¼ Railwayï¼Œæ”¯æ´å®Œæ•´ Node.js ç’°å¢ƒ
- æœ‰ cron åŠŸèƒ½
- å…è²»æ–¹æ¡ˆå¯ç”¨

### **Heroku**
- ç¶“å…¸é¸æ“‡ï¼Œæ”¯æ´å®Œæ•´ç’°å¢ƒ
- éœ€è¦ä¿¡ç”¨å¡é©—è­‰

æ‚¨éœ€è¦æˆ‘å¹«æ‚¨ä¿®æ”¹ç¨‹å¼ç¢¼ä»¥é©æ‡‰é€™äº›å¹³å°å—ï¼Ÿ

---

_**User**_

Zeabur å‘¢

---

_**Assistant**_

**Zeabur ä¹Ÿä¸é©åˆæ‚¨çš„å°ˆæ¡ˆï¼** åŸå› å¦‚ä¸‹ï¼š

## Zeabur çš„é™åˆ¶ï¼š

### 1. **ç„¡ä¼ºæœå™¨æ¶æ§‹**
- å’Œ Vercel ä¸€æ¨£ï¼ŒZeabur ä¸»è¦ç”¨æ–¼éœæ…‹ç¶²ç«™å’Œ API å‡½æ•¸
- ä¸æ”¯æ´é•·æ™‚é–“é‹è¡Œçš„èƒŒæ™¯ç¨‹åº

### 2. **ç€è¦½å™¨ç’°å¢ƒå•é¡Œ**
- ç„¡æ³•åŸ·è¡Œ Playwright çš„ Chromium ç€è¦½å™¨
- æ²’æœ‰å®Œæ•´çš„ç³»çµ±ç’°å¢ƒæ”¯æ´

### 3. **æª”æ¡ˆç³»çµ±é™åˆ¶**
- ç„¡æ³•å»ºç«‹è³‡æ–™å¤¾å’Œå„²å­˜ CSV æª”æ¡ˆ
- ä¸æ”¯æ´æŒçºŒæ€§çš„æª”æ¡ˆæ“ä½œ

## ç¸½çµå„å¹³å°é©åˆåº¦ï¼š

### âŒ **ä¸é©åˆçš„å¹³å°ï¼š**
- **Vercel** - ç„¡ä¼ºæœå™¨ï¼Œç„¡æ³•åŸ·è¡Œç€è¦½å™¨
- **Zeabur** - ç„¡ä¼ºæœå™¨ï¼Œç„¡æ³•åŸ·è¡Œç€è¦½å™¨
- **Netlify** - ç„¡ä¼ºæœå™¨ï¼Œç„¡æ³•åŸ·è¡Œç€è¦½å™¨

### âœ… **é©åˆçš„å¹³å°ï¼š**
- **Railway** - å®Œæ•´ Node.js ç’°å¢ƒï¼Œæ”¯æ´ Playwright
- **Render** - å®Œæ•´ Node.js ç’°å¢ƒï¼Œæ”¯æ´ Playwright  
- **Heroku** - å®Œæ•´ Node.js ç’°å¢ƒï¼Œæ”¯æ´ Playwright
- **DigitalOcean App Platform** - å®Œæ•´ç’°å¢ƒæ”¯æ´

### ğŸ”§ **éœ€è¦ä¿®æ”¹çš„åœ°æ–¹ï¼š**
- å°‡ Playwright æ”¹ç‚º headless æ¨¡å¼
- æ•´åˆ Google Drive API ä¸Šå‚³åŠŸèƒ½
- ç§»é™¤æœ¬åœ°æª”æ¡ˆå„²å­˜ï¼Œç›´æ¥ä¸Šå‚³åˆ°é›²ç«¯

æ‚¨å¸Œæœ›æˆ‘å¹«æ‚¨ä¿®æ”¹ç¨‹å¼ç¢¼ä»¥é©æ‡‰ Railway æˆ– Render å—ï¼Ÿ

---

_**User**_

GitHub Actions å‘¢

---

_**Assistant**_

**GitHub Actions æ˜¯å¾ˆå¥½çš„é¸æ“‡ï¼** ç‰¹åˆ¥é©åˆæ‚¨çš„éœ€æ±‚ï¼š

## GitHub Actions çš„å„ªå‹¢ï¼š

### 1. **å®Œå…¨æ”¯æ´ Playwright**
- æœ‰å®˜æ–¹çš„ Playwright å‹•ä½œ
- æ”¯æ´ headless ç€è¦½å™¨åŸ·è¡Œ
- å¯ä»¥å®‰è£ Chromium ç€è¦½å™¨

### 2. **å…§å»º Cron åŠŸèƒ½**
- ä½¿ç”¨ `schedule` è§¸ç™¼å™¨
- å¯ä»¥è¨­å®šæ¯é€±ä¸€åˆ°äº”çš„ 18:30 åŸ·è¡Œ
- é€±å…­ 10:15 åŸ·è¡Œ

### 3. **æª”æ¡ˆè™•ç†éˆæ´»**
- å¯ä»¥ä¸‹è¼‰ CSV æª”æ¡ˆ
- æ”¯æ´å¤šç¨®é›²ç«¯å„²å­˜æ•´åˆ
- å¯ä»¥ä¸Šå‚³åˆ° Google Drive

### 4. **å…è²»é¡åº¦å……è¶³**
- å…¬é–‹å°ˆæ¡ˆï¼šç„¡é™åˆ†é˜
- ç§äººå°ˆæ¡ˆï¼šæ¯æœˆ 2000 åˆ†é˜
- æ‚¨çš„çˆ¬èŸ²ç¨‹å¼åŸ·è¡Œæ™‚é–“åœ¨åˆç†ç¯„åœå…§

## å¯¦ä½œæ–¹å¼ï¼š

### **å·¥ä½œæµç¨‹çµæ§‹ï¼š**
```yaml
name: Stock Data Crawler
on:
  schedule:
    - cron: '30 18 * * 1-5'  # é€±ä¸€åˆ°äº” 18:30
    - cron: '15 10 * * 6'    # é€±å…­ 10:15
  workflow_dispatch:  # æ‰‹å‹•è§¸ç™¼
```

### **åŸ·è¡Œç’°å¢ƒï¼š**
- Ubuntu æœ€æ–°ç‰ˆæœ¬
- Node.js 18+
- Playwright ç€è¦½å™¨

### **æ•´åˆé¸é …ï¼š**
- Google Drive API ä¸Šå‚³
- ç›´æ¥ commit åˆ°å°ˆæ¡ˆ
- ç™¼é€é€šçŸ¥åˆ° Discord/Slack

æ‚¨å¸Œæœ›æˆ‘å¹«æ‚¨å»ºç«‹ GitHub Actions çš„è¨­å®šæª”å—ï¼Ÿé€™æ˜¯æœ€é©åˆæ‚¨éœ€æ±‚çš„è§£æ±ºæ–¹æ¡ˆï¼

---

_**User**_

æ•˜è¿°èªªæ˜å¦‚ä½•ä½¿ç”¨ GitHub Actions

---

_**Assistant**_

## GitHub Actions ä½¿ç”¨èªªæ˜

### **1. åŸºæœ¬æ¦‚å¿µ**
GitHub Actions æ˜¯ GitHub çš„ CI/CD å¹³å°ï¼Œå¯ä»¥è‡ªå‹•åŒ–åŸ·è¡Œæ‚¨çš„ç¨‹å¼ç¢¼ã€‚å°æ–¼æ‚¨çš„è‚¡ç¥¨è³‡æ–™çˆ¬èŸ²ï¼Œå®ƒæœƒæ ¹æ“šè¨­å®šçš„æ™‚é–“è‡ªå‹•åŸ·è¡Œï¼Œä¸‹è¼‰ CSV æª”æ¡ˆä¸¦ä¸Šå‚³åˆ° Google Driveã€‚

### **2. è¨­å®šæ­¥é©Ÿ**

#### **æ­¥é©Ÿ 1ï¼šå»ºç«‹å·¥ä½œæµç¨‹æª”æ¡ˆ**
åœ¨æ‚¨çš„å°ˆæ¡ˆæ ¹ç›®éŒ„å»ºç«‹ `.github/workflows/` è³‡æ–™å¤¾ï¼Œç„¶å¾Œå»ºç«‹ `crawler.yml` æª”æ¡ˆï¼š

```yaml
name: Stock Data Crawler
on:
  schedule:
    - cron: '30 18 * * 1-5'  # é€±ä¸€åˆ°äº” 18:30 (å°ç£æ™‚é–“)
    - cron: '15 10 * * 6'     # é€±å…­ 10:15 (å°ç£æ™‚é–“)
  workflow_dispatch:           # å…è¨±æ‰‹å‹•è§¸ç™¼

jobs:
  crawl-stock-data:
    runs-on: ubuntu-latest
    
    steps:
    - name: Checkout code
      uses: actions/checkout@v4
      
    - name: Setup Node.js
      uses: actions/setup-node@v4
      with:
        node-version: '18'
        
    - name: Install dependencies
      run: npm install
      
    - name: Install Playwright browsers
      run: npx playwright install chromium
      
    - name: Run crawler
      run: node app.js
      
    - name: Upload to Google Drive
      # é€™è£¡éœ€è¦æ•´åˆ Google Drive API
      run: echo "Upload to Google Drive"
```

#### **æ­¥é©Ÿ 2ï¼šä¿®æ”¹æ‚¨çš„ app.js**
éœ€è¦èª¿æ•´ç¨‹å¼ç¢¼ä»¥é©æ‡‰ GitHub Actions ç’°å¢ƒï¼š

```javascript
// ä¿®æ”¹ç€è¦½å™¨å•Ÿå‹•æ–¹å¼
const browser = await chromium.launch({
  headless: true,  // GitHub Actions éœ€è¦ headless æ¨¡å¼
  args: ['--no-sandbox', '--disable-setuid-sandbox']
});

// ç§»é™¤æœ¬åœ°æª”æ¡ˆå„²å­˜ï¼Œæ”¹ç‚ºç›´æ¥ä¸Šå‚³åˆ° Google Drive
// æˆ–è€…å°‡æª”æ¡ˆ commit åˆ°å°ˆæ¡ˆä¸­
```

### **3. æ™‚é–“è¨­å®šèªªæ˜**

#### **Cron èªæ³•æ ¼å¼ï¼š**
```
åˆ†é˜ å°æ™‚ æ—¥æœŸ æœˆä»½ æ˜ŸæœŸ
 30   18   *    *   1-5
```

- `30 18 * * 1-5` = æ¯å¤© 18:30ï¼Œä½†åªåœ¨é€±ä¸€åˆ°é€±äº”åŸ·è¡Œ
- `15 10 * * 6` = æ¯é€±å…­ 10:15 åŸ·è¡Œ

#### **å°ç£æ™‚é–“å°æ‡‰ï¼š**
- GitHub Actions ä½¿ç”¨ UTC æ™‚é–“
- å°ç£æ™‚é–“ = UTC + 8
- æ‰€ä»¥ 18:30 å°ç£æ™‚é–“ = 10:30 UTC

### **4. åŸ·è¡Œæ–¹å¼**

#### **è‡ªå‹•åŸ·è¡Œï¼š**
- æ ¹æ“š cron æ™‚é–“è‡ªå‹•è§¸ç™¼
- ç„¡éœ€äººå·¥å¹²é 

#### **æ‰‹å‹•åŸ·è¡Œï¼š**
- åœ¨ GitHub å°ˆæ¡ˆé é¢é»æ“Š "Actions" æ¨™ç±¤
- é¸æ“‡ "Stock Data Crawler" å·¥ä½œæµç¨‹
- é»æ“Š "Run workflow" æŒ‰éˆ•

### **5. ç›£æ§å’Œé™¤éŒ¯**

#### **æŸ¥çœ‹åŸ·è¡Œç‹€æ…‹ï¼š**
- åœ¨ Actions é é¢å¯ä»¥çœ‹åˆ°æ‰€æœ‰åŸ·è¡Œè¨˜éŒ„
- ç¶ è‰²å‹¾å‹¾ = æˆåŠŸ
- ç´…è‰²å‰å‰ = å¤±æ•—

#### **æŸ¥çœ‹æ—¥èªŒï¼š**
- é»æ“Šå¤±æ•—çš„åŸ·è¡Œè¨˜éŒ„
- å±•é–‹å„å€‹æ­¥é©ŸæŸ¥çœ‹è©³ç´°æ—¥èªŒ
- å¯ä»¥ä¸‹è¼‰å®Œæ•´çš„åŸ·è¡Œæ—¥èªŒ

### **6. é€²éšåŠŸèƒ½**

#### **æ¢ä»¶åŸ·è¡Œï¼š**
```yaml
- name: Run crawler
  if: github.event_name == 'schedule'  # åªåœ¨æ’ç¨‹æ™‚åŸ·è¡Œ
  run: node app.js
```

#### **éŒ¯èª¤è™•ç†ï¼š**
```yaml
- name: Run crawler
  continue-on-error: true  # å³ä½¿å¤±æ•—ä¹Ÿç¹¼çºŒåŸ·è¡Œ
  run: node app.js
```

#### **é€šçŸ¥åŠŸèƒ½ï¼š**
```yaml
- name: Notify on failure
  if: failure()
  run: echo "Crawler failed!"
  # å¯ä»¥æ•´åˆ Discord/Slack é€šçŸ¥
```

### **7. æ³¨æ„äº‹é …**

#### **å…è²»é¡åº¦ï¼š**
- å…¬é–‹å°ˆæ¡ˆï¼šç„¡é™åˆ†é˜
- ç§äººå°ˆæ¡ˆï¼šæ¯æœˆ 2000 åˆ†é˜
- æ‚¨çš„çˆ¬èŸ²ç¨‹å¼åŸ·è¡Œæ™‚é–“ç´„ 5-10 åˆ†é˜/æ¬¡

#### **å®‰å…¨æ€§ï¼š**
- æ•æ„Ÿè³‡è¨Šï¼ˆå¦‚ API é‡‘é‘°ï¼‰è¦ä½¿ç”¨ GitHub Secrets
- ä¸è¦å°‡å¯†ç¢¼ç›´æ¥å¯«åœ¨ç¨‹å¼ç¢¼ä¸­

#### **æ•ˆèƒ½å„ªåŒ–ï¼š**
- ä½¿ç”¨ `actions/cache` å¿«å– node_modules
- è€ƒæ…®ä½¿ç”¨ Docker å®¹å™¨

é€™æ¨£è¨­å®šå¾Œï¼Œæ‚¨çš„è‚¡ç¥¨è³‡æ–™çˆ¬èŸ²å°±æœƒæŒ‰ç…§è¨­å®šçš„æ™‚é–“è‡ªå‹•åŸ·è¡Œï¼Œå®Œå…¨ä¸éœ€è¦æ‰‹å‹•æ“ä½œï¼

---

_**User**_

ä¸‹è¼‰çš„æª”æ¡ˆå¦‚ä½•æ”¾åˆ° Google Drive æŒ‡å®šè³‡æ–™å¤¾

---

_**Assistant**_

## å°‡ä¸‹è¼‰çš„ CSV æª”æ¡ˆä¸Šå‚³åˆ° Google Drive æŒ‡å®šè³‡æ–™å¤¾

### **1. è¨­å®š Google Drive API**

#### **æ­¥é©Ÿ 1ï¼šå»ºç«‹ Google Cloud å°ˆæ¡ˆ**
1. å‰å¾€ [Google Cloud Console](https://console.cloud.google.com/)
2. å»ºç«‹æ–°å°ˆæ¡ˆæˆ–é¸æ“‡ç¾æœ‰å°ˆæ¡ˆ
3. å•Ÿç”¨ Google Drive API

#### **æ­¥é©Ÿ 2ï¼šå»ºç«‹æœå‹™å¸³æˆ¶**
1. åœ¨ IAM èˆ‡ç®¡ç† â†’ æœå‹™å¸³æˆ¶ä¸­å»ºç«‹æ–°å¸³æˆ¶
2. ä¸‹è¼‰ JSON é‡‘é‘°æª”æ¡ˆ
3. å°‡æœå‹™å¸³æˆ¶åŠ å…¥ Google Drive è³‡æ–™å¤¾çš„å…±ç”¨æ¬Šé™

### **2. ä¿®æ”¹æ‚¨çš„ app.js**

#### **å®‰è£å¿…è¦å¥—ä»¶ï¼š**
```bash
npm install googleapis
```

#### **ç¨‹å¼ç¢¼ä¿®æ”¹ï¼š**
```javascript
const {google} = require('googleapis');
const path = require('path');

// Google Drive è¨­å®š
const SCOPES = ['https://www.googleapis.com/auth/drive'];
const FOLDER_ID = 'æ‚¨çš„GoogleDriveè³‡æ–™å¤¾ID'; // å¾URLå–å¾—

// å»ºç«‹ Google Drive èªè­‰
async function createAuthClient() {
  const auth = new google.auth.GoogleAuth({
    keyFile: './google-credentials.json', // æœå‹™å¸³æˆ¶é‡‘é‘°æª”æ¡ˆ
    scopes: SCOPES,
  });
  return auth;
}

// ä¸Šå‚³æª”æ¡ˆåˆ° Google Drive
async function uploadToGoogleDrive(filePath, fileName) {
  try {
    const auth = await createAuthClient();
    const drive = google.drive({version: 'v3', auth});
    
    const fileMetadata = {
      name: fileName,
      parents: [FOLDER_ID] // æŒ‡å®šè³‡æ–™å¤¾ID
    };
    
    const media = {
      mimeType: 'text/csv',
      body: require('fs').createReadStream(filePath)
    };
    
    const file = await drive.files.create({
      resource: fileMetadata,
      media: media,
      fields: 'id'
    });
    
    console.log(`æª”æ¡ˆ ${fileName} å·²ä¸Šå‚³åˆ° Google Driveï¼ŒID: ${file.data.id}`);
    return file.data.id;
  } catch (error) {
    console.error(`ä¸Šå‚³ ${fileName} æ™‚ç™¼ç”ŸéŒ¯èª¤:`, error);
    throw error;
  }
}

// ä¿®æ”¹ä¸‹è¼‰å‡½æ•¸ï¼Œä¸‹è¼‰å¾Œç«‹å³ä¸Šå‚³
async function downloadStockDataWeekday() {
  const browser = await chromium.launch({headless: true});
  const page = await browser.newPage();
  console.log("é–‹å§‹åŸ·è¡Œè‚¡ç¥¨è³‡æ–™ä¸‹è¼‰...");

  try {
    // æ¯æ—¥ä¸Šå¸‚æ”¶ç›¤åƒ¹
    await page.goto("https://www.twse.com.tw/zh/trading/historical/mi-index.html");
    await page.selectOption("#label1", "ALLBUT0999");
    await page.click("button.search");
    await page.waitForTimeout(2000);

    let downloadPromise = page.waitForEvent("download");
    await page.click("button.csv");
    let download = await downloadPromise;
    
    // å»ºç«‹æš«å­˜è³‡æ–™å¤¾
    const tempDir = './temp';
    await fs.mkdir(tempDir, {recursive: true});
    
    // ä¸‹è¼‰åˆ°æš«å­˜ä½ç½®
    const filePath = path.join(tempDir, `${todayDate}ä¸Šå¸‚æ”¶ç›¤åƒ¹.csv`);
    await download.saveAs(filePath);
    
    // ä¸Šå‚³åˆ° Google Drive
    await uploadToGoogleDrive(filePath, `${todayDate}ä¸Šå¸‚æ”¶ç›¤åƒ¹.csv`);
    
    // åˆªé™¤æš«å­˜æª”æ¡ˆ
    await fs.unlink(filePath);
    
    // é‡è¤‡ç›¸åŒæµç¨‹è™•ç†å…¶ä»–æª”æ¡ˆ...
    
  } catch (error) {
    console.error("ä¸‹è¼‰éç¨‹ä¸­ç™¼ç”ŸéŒ¯èª¤:", error);
  } finally {
    await browser.close();
  }
}
```

### **3. GitHub Actions æ•´åˆ**

#### **è¨­å®š Secretsï¼š**
åœ¨ GitHub å°ˆæ¡ˆè¨­å®š â†’ Secrets and variables â†’ Actions ä¸­æ–°å¢ï¼š
- `GOOGLE_CREDENTIALS`: æ•´å€‹ JSON é‡‘é‘°æª”æ¡ˆçš„å…§å®¹

#### **ä¿®æ”¹å·¥ä½œæµç¨‹ï¼š**
```yaml
name: Stock Data Crawler
on:
  schedule:
    - cron: '30 18 * * 1-5'
    - cron: '15 10 * * 6'
  workflow_dispatch:

jobs:
  crawl-stock-data:
    runs-on: ubuntu-latest
    
    steps:
    - name: Checkout code
      uses: actions/checkout@v4
      
    - name: Setup Node.js
      uses: actions/setup-node@v4
      with:
        node-version: '18'
        
    - name: Install dependencies
      run: npm install
      
    - name: Install Playwright browsers
      run: npx playwright install chromium
      
    - name: Setup Google credentials
      run: |
        echo '${{ secrets.GOOGLE_CREDENTIALS }}' > google-credentials.json
      
    - name: Run crawler
      run: node app.js
      
    - name: Cleanup
      run: rm -f google-credentials.json
```

### **4. å–å¾— Google Drive è³‡æ–™å¤¾ ID**

#### **æ–¹æ³• 1ï¼šå¾ URL å–å¾—**
1. åœ¨ Google Drive ä¸­é–‹å•Ÿç›®æ¨™è³‡æ–™å¤¾
2. URL æ ¼å¼ï¼š`https://drive.google.com/drive/folders/FOLDER_ID`
3. è¤‡è£½ `FOLDER_ID` éƒ¨åˆ†

#### **æ–¹æ³• 2ï¼šä½¿ç”¨ Google Drive API æŸ¥è©¢**
```javascript
// åˆ—å‡ºæ‰€æœ‰è³‡æ–™å¤¾
async function listFolders() {
  const auth = await createAuthClient();
  const drive = google.drive({version: 'v3', auth});
  
  const response = await drive.files.list({
    q: "mimeType='application/vnd.google-apps.folder'",
    fields: 'files(id, name)',
  });
  
  console.log('è³‡æ–™å¤¾åˆ—è¡¨:', response.data.files);
}
```

### **5. é€²éšåŠŸèƒ½**

#### **æª”æ¡ˆå»é‡è™•ç†ï¼š**
```javascript
// æª¢æŸ¥æª”æ¡ˆæ˜¯å¦å·²å­˜åœ¨
async function checkFileExists(fileName) {
  const auth = await createAuthClient();
  const drive = google.drive({version: 'v3', auth});
  
  const response = await drive.files.list({
    q: `name='${fileName}' and '${FOLDER_ID}' in parents`,
    fields: 'files(id, name)',
  });
  
  return response.data.files.length > 0;
}
```

#### **è‡ªå‹•å»ºç«‹æ—¥æœŸè³‡æ–™å¤¾ï¼š**
```javascript
// åœ¨ Google Drive ä¸­å»ºç«‹æ—¥æœŸè³‡æ–™å¤¾
async function createDateFolder(dateString) {
  const auth = await createAuthClient();
  const drive = google.drive({version: 'v3', auth});
  
  const fileMetadata = {
    name: dateString,
    mimeType: 'application/vnd.google-apps.folder',
    parents: [FOLDER_ID]
  };
  
  const folder = await drive.files.create({
    resource: fileMetadata,
    fields: 'id'
  });
  
  return folder.data.id;
}
```

é€™æ¨£è¨­å®šå¾Œï¼Œæ‚¨çš„ CSV æª”æ¡ˆå°±æœƒè‡ªå‹•ä¸‹è¼‰ä¸¦ä¸Šå‚³åˆ° Google Drive çš„æŒ‡å®šè³‡æ–™å¤¾ä¸­ï¼

---

